<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelBid - NFT Art Marketplace</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏, –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã */
        .role-badge {
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 8px;
        }
        
        .admin-badge {
            background: #dc3545;
            color: white;
        }
        
        .moderator-badge {
            background: #4a6fa5;
            color: white;
        }
        
        .wallet-connected {
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="main-screen" class="screen active">
            <header>
                <div class="logo">üé® PixelBid <span id="role-badge"></span></div>
                <div id="user-balance">0.00 TON</div>
            </header>
            
            <div class="nav-tabs">
                <div class="nav-tab active" data-screen="editor">üé® –°–æ–∑–¥–∞—Ç—å</div>
                <div class="nav-tab" data-screen="my-arts">üñºÔ∏è –ú–æ–∏ –∞—Ä—Ç—ã</div>
                <div class="nav-tab" data-screen="auctions">üèÜ –ê—É–∫—Ü–∏–æ–Ω—ã</div>
                <div class="nav-tab" data-screen="market">üõí –ú–∞–≥–∞–∑–∏–Ω</div>
                <div class="nav-tab" data-screen="profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
                <div class="nav-tab" data-screen="moderation" id="moderation-tab" style="display: none;">üëÆ –ú–æ–¥–µ—Ä–∞—Ü–∏—è</div>
            </div>
            
            <div class="card">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="user-name">–ì–æ—Å—Ç—å</span>!</h2>
                <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ, –ø—Ä–æ–¥–∞–≤–∞–π—Ç–µ –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–∏—Ä—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–∏–∫—Å–µ–ª—å–Ω—ã–µ –∞—Ä—Ç—ã</p>
                <button class="btn btn-primary" data-screen="editor">
                    üé® –ù–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ
                </button>
            </div>
            
            <h3>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ª–æ—Ç—ã</h3>
            <div class="grid" id="featured-auctions">
                <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞—É–∫—Ü–∏–æ–Ω—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
        <div id="editor-screen" class="screen">
            <header>
                <button class="btn btn-outline back-btn">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="logo">–†–µ–¥–∞–∫—Ç–æ—Ä</div>
                <button class="btn btn-primary" id="save-art-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </header>
            
            <div class="card">
                <div class="editor-tools">
                    <button class="tool-btn active" data-tool="pencil">–ö–∞—Ä–∞–Ω–¥–∞—à</button>
                    <button class="tool-btn" data-tool="eraser">–õ–∞—Å—Ç–∏–∫</button>
                    <button class="tool-btn" data-tool="fill">–ó–∞–ª–∏–≤–∫–∞</button>
                </div>
                
                <div class="color-palette" id="color-palette">
                    <!-- –¶–≤–µ—Ç–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                
                <div class="editor-canvas-container">
                    <div id="pixel-canvas"></div>
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –º–æ–∏—Ö –∞—Ä—Ç–æ–≤ -->
        <div id="my-arts-screen" class="screen">
            <header>
                <button class="btn btn-outline back-btn">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="logo">–ú–æ–∏ –∞—Ä—Ç—ã</div>
            </header>
            
            <div class="card">
                <div id="arts-filter" class="nav-tabs">
                    <div class="nav-tab active" data-status="all">–í—Å–µ</div>
                    <div class="nav-tab" data-status="approved">–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ</div>
                    <div class="nav-tab" data-status="pending">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
                    <div class="nav-tab" data-status="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ</div>
                </div>
                
                <div class="grid" id="user-arts-list">
                    <!-- –ê—Ä—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –∞—É–∫—Ü–∏–æ–Ω–æ–≤ -->
        <div id="auctions-screen" class="screen">
            <header>
                <button class="btn btn-outline back-btn">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="logo">–ú–æ–∏ –∞—É–∫—Ü–∏–æ–Ω—ã</div>
                <button class="btn btn-primary" id="create-auction-btn">‚ûï –ù–æ–≤—ã–π –∞—É–∫—Ü–∏–æ–Ω</button>
            </header>
            
            <div class="card">
                <div id="my-auctions-list">
                    <!-- –°–ø–∏—Å–æ–∫ –∞—É–∫—Ü–∏–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –º–∞–≥–∞–∑–∏–Ω–∞ -->
        <div id="market-screen" class="screen">
            <header>
                <button class="btn btn-outline back-btn">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="logo">–ú–∞–≥–∞–∑–∏–Ω</div>
            </header>
            
            <div class="card">
                <h3>–í—Å–µ –∞—É–∫—Ü–∏–æ–Ω—ã</h3>
                <div class="grid" id="all-auctions">
                    <!-- –í—Å–µ –∞—É–∫—Ü–∏–æ–Ω—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è -->
        <div id="profile-screen" class="screen">
            <header>
                <button class="btn btn-outline back-btn">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="logo">–ü—Ä–æ—Ñ–∏–ª—å</div>
            </header>
            
            <div class="card">
                <div class="form-group">
                    <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="username" readonly>
                </div>
                
                <div class="form-group">
                    <label>ID Telegram</label>
                    <input type="text" id="user-id" readonly>
                </div>
                
                <div class="form-group">
                    <label>–†–æ–ª—å</label>
                    <input type="text" id="user-role" readonly>
                </div>
                
                <div class="form-group">
                    <label>–ë–∞–ª–∞–Ω—Å TON</label>
                    <input type="text" id="user-balance-profile" readonly>
                </div>
                
                <div class="form-group">
                    <label>TON –ö–æ—à–µ–ª–µ–∫</label>
                    <div class="wallet-address" id="wallet-address">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</div>
                    <button class="btn btn-primary" id="connect-wallet-btn">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
                </div>
                
                <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="card">
                    <p>üé® –°–æ–∑–¥–∞–Ω–æ –∞—Ä—Ç–æ–≤: <span id="art-count">0</span></p>
                    <p>üí∞ –ü—Ä–æ–¥–∞–Ω–æ –∞—Ä—Ç–æ–≤: <span id="sold-count">0</span></p>
                    <p>üèÜ –¢–µ–∫—É—â–∏—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤: <span id="auctions-count">0</span></p>
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
        <div id="moderation-screen" class="screen">
            <header>
                <button class="btn btn-outline back-btn">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="logo">–ú–æ–¥–µ—Ä–∞—Ü–∏—è</div>
            </header>
            
            <div class="card">
                <div class="nav-tabs">
                    <div class="nav-tab active" data-tab="arts">–ê—Ä—Ç—ã</div>
                    <div class="nav-tab" data-tab="moderators">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã</div>
                </div>
                
                <div id="moderation-content">
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞ -->
        <div class="modal" id="create-auction-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">–°–æ–∑–¥–∞—Ç—å –∞—É–∫—Ü–∏–æ–Ω</div>
                    <div class="modal-close" id="close-auction-modal">√ó</div>
                </div>
                
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ –∞—Ä—Ç</label>
                    <select id="art-select">
                        <!-- –ê—Ä—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞</label>
                    <input type="text" id="auction-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ NFT">
                </div>
                
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="auction-description" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à –∞—Ä—Ç"></textarea>
                </div>
                
                <div class="form-group">
                    <label>–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ (TON)</label>
                    <input type="number" id="auction-start-price" min="0.1" step="0.1" value="0.5">
                </div>
                
                <div class="form-group">
                    <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—É–∫—Ü–∏–æ–Ω–∞</label>
                    <select id="auction-duration">
                        <option value="1">1 –¥–µ–Ω—å</option>
                        <option value="3">3 –¥–Ω—è</option>
                        <option value="7" selected>7 –¥–Ω–µ–π</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" id="create-auction-submit">–°–æ–∑–¥–∞—Ç—å –∞—É–∫—Ü–∏–æ–Ω</button>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É–∫—Ü–∏–æ–Ω–∞ -->
        <div class="modal" id="auction-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="auction-modal-title">–ê—É–∫—Ü–∏–æ–Ω</div>
                    <div class="modal-close" id="close-auction-detail">√ó</div>
                </div>
                
                <div id="auction-modal-content">
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞—É–∫—Ü–∏–æ–Ω–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const PixelBidApp = {
            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
            config: {
                gridSize: 16,
                pixelSize: 20,
                colors: [
                    '#000000', '#FF0000', '#00FF00', '#0000FF', 
                    '#FFFF00', '#FF00FF', '#00FFFF', '#FFFFFF',
                    '#FFA500', '#800080', '#008080', '#808000',
                    '#800000', '#008000', '#000080', '#808080'
                ],
                adminId: 370552943 // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π ID
            },
            
            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            state: {
                currentScreen: 'main',
                user: null,
                balance: 0,
                wallet: null,
                arts: [],
                auctions: [],
                selectedColor: '#000000',
                currentTool: 'pencil',
                isAdmin: false,
                isModerator: false,
                selectedArtForAuction: null,
                moderators: [],
                tonConnection: null
            },
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            init() {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
                this.loadLocalData();
                
                // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
                this.initUser();
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                this.setupNavigation();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                this.loadUserData();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
                this.initEditor();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–∫—Ü–∏–æ–Ω–æ–≤
                this.initAuctions();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—à–µ–ª—å–∫–∞
                this.initWallet();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TON –∫–æ—à–µ–ª—å–∫–∞
                this.initTONConnection();
            },
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
            loadLocalData() {
                const savedArts = localStorage.getItem('arts');
                if (savedArts) this.state.arts = JSON.parse(savedArts);
                
                const savedAuctions = localStorage.getItem('auctions');
                if (savedAuctions) this.state.auctions = JSON.parse(savedAuctions);
                
                const savedModerators = localStorage.getItem('moderators');
                if (savedModerators) {
                    this.state.moderators = JSON.parse(savedModerators);
                } else {
                    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                    this.state.moderators = [this.config.adminId];
                    localStorage.setItem('moderators', JSON.stringify(this.state.moderators));
                }
            },
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            initUser() {
                const initData = Telegram.WebApp.initDataUnsafe;
                this.state.user = {
                    id: initData.user?.id || Math.floor(Math.random() * 1000000),
                    firstName: initData.user?.first_name || '–ì–æ—Å—Ç—å',
                    username: initData.user?.username || 'guest'
                };
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
                this.state.isAdmin = this.state.user.id === this.config.adminId;
                this.state.isModerator = this.state.moderators.includes(this.state.user.id) || this.state.isAdmin;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                document.getElementById('user-name').textContent = this.state.user.firstName;
                document.getElementById('username').value = this.state.user.firstName;
                document.getElementById('user-id').value = this.state.user.id;
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–æ–ª–∏
                let roleBadge = '';
                if (this.state.isAdmin) {
                    roleBadge = '<span class="role-badge admin-badge">ADMIN</span>';
                } else if (this.state.isModerator) {
                    roleBadge = '<span class="role-badge moderator-badge">MOD</span>';
                }
                document.getElementById('role-badge').innerHTML = roleBadge;
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –≤–∫–ª–∞–¥–∫—É –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤
                if (this.state.isModerator) {
                    document.getElementById('moderation-tab').style.display = 'flex';
                }
            },
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            setupNavigation() {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Ç–∞–±–∞–º
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.nav-tab').forEach(t => {
                            t.classList.remove('active');
                        });
                        tab.classList.add('active');
                        this.showScreen(tab.dataset.screen);
                    });
                });
                
                // –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
                document.querySelectorAll('.back-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.showScreen('main'));
                });
                
                // –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞
                document.querySelectorAll('[data-screen]').forEach(btn => {
                    if (btn.classList.contains('nav-tab')) return;
                    btn.addEventListener('click', () => {
                        this.showScreen(btn.dataset.screen);
                    });
                });
                
                // –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞
                document.getElementById('create-auction-btn')?.addEventListener('click', () => {
                    this.showCreateAuctionModal();
                });
                
                // –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—Ä—Ç–∞
                document.getElementById('save-art-btn')?.addEventListener('click', () => {
                    this.saveArt();
                });
                
                // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
                document.getElementById('connect-wallet-btn')?.addEventListener('click', () => {
                    this.connectWallet();
                });
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
                document.getElementById('close-auction-modal')?.addEventListener('click', () => {
                    document.getElementById('create-auction-modal').classList.remove('active');
                });
                
                document.getElementById('close-auction-detail')?.addEventListener('click', () => {
                    document.getElementById('auction-modal').classList.remove('active');
                });
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞
                document.getElementById('create-auction-submit')?.addEventListener('click', () => {
                    this.createAuction();
                });
            },
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω
            showScreen(screenId) {
                // –°–∫—Ä—ã—Ç—å –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω
                const screen = document.getElementById(`${screenId}-screen`);
                if (screen) {
                    screen.classList.add('active');
                    this.state.currentScreen = screenId;
                    
                    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
                    if (screenId === 'editor' && !this.state.editorInitialized) {
                        this.initEditorCanvas();
                    }
                    else if (screenId === 'my-arts') {
                        this.loadUserArts();
                    }
                    else if (screenId === 'auctions') {
                        this.loadUserAuctions();
                    }
                    else if (screenId === 'market') {
                        this.loadAllAuctions();
                    }
                    else if (screenId === 'profile') {
                        this.updateProfile();
                    }
                    else if (screenId === 'moderation') {
                        this.renderModerationContent('arts');
                    }
                }
            },
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserData() {
                // –ó–∞–≥–ª—É—à–∫–∞ - –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å –∫ API
                setTimeout(() => {
                    this.state.balance = 5.25;
                    document.getElementById('user-balance').textContent = `${this.state.balance} TON`;
                    document.getElementById('user-balance-profile').value = `${this.state.balance} TON`;
                    
                    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                    this.loadSampleArts();
                    this.loadSampleAuctions();
                    this.updateFeaturedAuctions();
                }, 500);
            },
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            initEditor() {
                this.state.editorInitialized = false;
                this.initColorPalette();
            },
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–ª–∏—Ç—Ä—ã —Ü–≤–µ—Ç–æ–≤
            initColorPalette() {
                const palette = document.getElementById('color-palette');
                palette.innerHTML = '';
                
                this.config.colors.forEach(color => {
                    const colorElement = document.createElement('div');
                    colorElement.className = 'color-option';
                    if (color === this.state.selectedColor) {
                        colorElement.classList.add('selected');
                    }
                    colorElement.style.backgroundColor = color;
                    colorElement.dataset.color = color;
                    colorElement.addEventListener('click', () => {
                        this.selectColor(color);
                    });
                    palette.appendChild(colorElement);
                });
                
                // –í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
                document.querySelectorAll('.tool-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.tool-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        btn.classList.add('active');
                        this.state.currentTool = btn.dataset.tool;
                    });
                });
            },
            
            // –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
            selectColor(color) {
                this.state.selectedColor = color;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.toggle('selected', option.dataset.color === color);
                });
            },
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö–æ–ª—Å—Ç–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            initEditorCanvas() {
                const canvas = document.getElementById('pixel-canvas');
                canvas.innerHTML = '';
                canvas.style.gridTemplateColumns = `repeat(${this.config.gridSize}, ${this.config.pixelSize}px)`;
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∏–∫—Å–µ–ª–µ–π
                for (let i = 0; i < this.config.gridSize * this.config.gridSize; i++) {
                    const pixel = document.createElement('div');
                    pixel.className = 'pixel';
                    pixel.dataset.index = i;
                    
                    pixel.addEventListener('click', () => {
                        if (this.state.currentTool === 'pencil') {
                            pixel.style.backgroundColor = this.state.selectedColor;
                        } else if (this.state.currentTool === 'eraser') {
                            pixel.style.backgroundColor = '';
                        }
                    });
                    
                    canvas.appendChild(pixel);
                }
                
                this.state.editorInitialized = true;
            },
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—Ä—Ç–∞
            saveArt() {
                const artData = {
                    id: Date.now(),
                    title: `–ú–æ–π –∞—Ä—Ç #${Math.floor(Math.random() * 100)}`,
                    pixels: [],
                    created: new Date().toISOString(),
                    authorId: this.state.user.id,
                    authorName: this.state.user.firstName,
                    status: 'pending' // –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
                };
                
                // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π
                document.querySelectorAll('.pixel').forEach(pixel => {
                    artData.pixels.push(pixel.style.backgroundColor || '');
                });
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
                this.state.arts.push(artData);
                localStorage.setItem('arts', JSON.stringify(this.state.arts));
                
                // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                Telegram.WebApp.showAlert('–ê—Ä—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é!');
                
                // –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
                this.showScreen('main');
            },
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–∫—Ü–∏–æ–Ω–æ–≤
            initAuctions() {
                // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.art-card')) {
                        const auctionId = e.target.closest('.art-card').dataset.id;
                        this.showAuctionDetails(auctionId);
                    }
                });
            },
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞
            showCreateAuctionModal() {
                const artSelect = document.getElementById('art-select');
                artSelect.innerHTML = '';
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –∞—Ä—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userArts = this.state.arts.filter(art => 
                    art.authorId === this.state.user.id && 
                    art.status === 'approved'
                );
                
                if (userArts.length === 0) {
                    artSelect.innerHTML = '<option value="">–£ –≤–∞—Å –Ω–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –∞—Ä—Ç–æ–≤</option>';
                    return;
                }
                
                userArts.forEach(art => {
                    const option = document.createElement('option');
                    option.value = art.id;
                    option.textContent = art.title;
                    artSelect.appendChild(option);
                });
                
                document.getElementById('create-auction-modal').classList.add('active');
            },
            
            // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∞—É–∫—Ü–∏–æ–Ω
            createAuction() {
                const artId = parseInt(document.getElementById('art-select').value);
                const title = document.getElementById('auction-title').value;
                const description = document.getElementById('auction-description').value;
                const startPrice = parseFloat(document.getElementById('auction-start-price').value);
                const duration = parseInt(document.getElementById('auction-duration').value);
                
                if (!artId || !title || !startPrice) {
                    Telegram.WebApp.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                    return;
                }
                
                const art = this.state.arts.find(a => a.id === artId);
                if (!art) return;
                
                const auction = {
                    id: Date.now(),
                    artId: art.id,
                    title: title,
                    description: description,
                    startPrice: startPrice,
                    currentPrice: startPrice,
                    duration: duration,
                    startDate: new Date().toISOString(),
                    endDate: new Date(Date.now() + duration * 24 * 60 * 60 * 1000).toISOString(),
                    authorId: this.state.user.id,
                    bids: [],
                    status: 'active'
                };
                
                this.state.auctions.push(auction);
                localStorage.setItem('auctions', JSON.stringify(this.state.auctions));
                document.getElementById('create-auction-modal').classList.remove('active');
                Telegram.WebApp.showAlert('–ê—É–∫—Ü–∏–æ–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
                this.loadUserAuctions();
            },
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤
            loadUserAuctions() {
                const container = document.getElementById('my-auctions-list');
                container.innerHTML = '';
                
                const userAuctions = this.state.auctions.filter(
                    auction => auction.authorId === this.state.user.id
                );
                
                if (userAuctions.length === 0) {
                    container.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤</p>';
                    return;
                }
                
                userAuctions.forEach(auction => {
                    const art = this.state.arts.find(a => a.id === auction.artId);
                    if (!art) return;
                    
                    const auctionEl = document.createElement('div');
                    auctionEl.className = 'card';
                    auctionEl.innerHTML = `
                        <h3>${auction.title}</h3>
                        <p>–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: <strong>${auction.currentPrice} TON</strong></p>
                        <p>–°—Ç–∞–≤–æ–∫: ${auction.bids.length}</p>
                        <p>–û–∫–æ–Ω—á–∞–Ω–∏–µ: ${new Date(auction.endDate).toLocaleDateString()}</p>
                        <button class="btn btn-sm btn-primary" data-id="${auction.id}">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å</button>
                    `;
                    container.appendChild(auctionEl);
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
                container.querySelectorAll('button').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const auctionId = parseInt(btn.dataset.id);
                        this.showAuctionDetails(auctionId);
                    });
                });
            },
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤
            loadAllAuctions() {
                const container = document.getElementById('all-auctions');
                container.innerHTML = '';
                
                this.state.auctions.forEach(auction => {
                    const art = this.state.arts.find(a => a.id === auction.artId);
                    if (!art) return;
                    
                    const auctionEl = document.createElement('div');
                    auctionEl.className = 'art-card';
                    auctionEl.dataset.id = auction.id;
                    auctionEl.innerHTML = `
                        <div class="art-preview" style="background-color: ${art.pixels[0] || '#ccc'};"></div>
                        <div class="art-info">
                            <div class="art-title">${auction.title}</div>
                            <div class="art-price">${auction.currentPrice} TON</div>
                            <div class="art-status">–û—Å—Ç–∞–ª–æ—Å—å: ${this.getTimeLeft(auction.endDate)}</div>
                        </div>
                    `;
                    container.appendChild(auctionEl);
                });
            },
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∞—É–∫—Ü–∏–æ–Ω–∞
            showAuctionDetails(auctionId) {
                const auction = this.state.auctions.find(a => a.id === auctionId);
                if (!auction) return;
                
                const art = this.state.arts.find(a => a.id === auction.artId);
                if (!art) return;
                
                const container = document.getElementById('auction-modal-content');
                container.innerHTML = `
                    <div class="card">
                        <h3>${auction.title}</h3>
                        <div class="art-preview" style="height: 200px; background-color: ${art.pixels[0] || '#ccc'};"></div>
                        <p>${auction.description}</p>
                        <p>–ê–≤—Ç–æ—Ä: ${art.authorName}</p>
                    </div>
                    
                    <div class="card">
                        <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞—É–∫—Ü–∏–æ–Ω–µ</h4>
                        <p>–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: <strong>${auction.currentPrice} TON</strong></p>
                        <p>–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞: ${auction.startPrice} TON</p>
                        <p>–°—Ç–∞–≤–æ–∫: ${auction.bids.length}</p>
                        <p>–ù–∞—á–∞–ª–æ: ${new Date(auction.startDate).toLocaleDateString()}</p>
                        <p>–û–∫–æ–Ω—á–∞–Ω–∏–µ: ${new Date(auction.endDate).toLocaleDateString()} (${this.getTimeLeft(auction.endDate)})</p>
                    </div>
                    
                    <div class="card">
                        <h4>–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</h4>
                        <div class="form-group">
                            <label>–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ (TON)</label>
                            <input type="number" id="bid-amount" min="${auction.currentPrice + 0.1}" step="0.1" value="${auction.currentPrice + 0.1}">
                        </div>
                        <button class="btn btn-primary" id="place-bid-btn">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
                    </div>
                `;
                
                document.getElementById('auction-modal').classList.add('active');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞–≤–∫–∏
                document.getElementById('place-bid-btn')?.addEventListener('click', () => {
                    this.placeBid(auctionId);
                });
            },
            
            // –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
            placeBid(auctionId) {
                const amount = parseFloat(document.getElementById('bid-amount').value);
                const auction = this.state.auctions.find(a => a.id === auctionId);
                
                if (!auction) return;
                if (amount <= auction.currentPrice) {
                    Telegram.WebApp.showAlert('–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã—à–µ —Ç–µ–∫—É—â–µ–π!');
                    return;
                }
                
                auction.bids.push({
                    userId: this.state.user.id,
                    amount: amount,
                    date: new Date().toISOString()
                });
                
                auction.currentPrice = amount;
                localStorage.setItem('auctions', JSON.stringify(this.state.auctions));
                Telegram.WebApp.showAlert(`–°—Ç–∞–≤–∫–∞ –≤ ${amount} TON —É—Å–ø–µ—à–Ω–æ —Å–¥–µ–ª–∞–Ω–∞!`);
                document.getElementById('auction-modal').classList.remove('active');
            },
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—à–µ–ª—å–∫–∞
            initWallet() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫
                const savedWallet = localStorage.getItem('ton_wallet');
                if (savedWallet) {
                    this.state.wallet = JSON.parse(savedWallet);
                    document.getElementById('wallet-address').textContent = this.state.wallet.address;
                }
            },
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TON –∫–æ—à–µ–ª—å–∫–∞
            initTONConnection() {
                this.state.tonConnection = new TonConnectSDK.TonConnect({
                    manifestUrl: 'https://misterigra.github.io/pixelbid2/tonconnect-manifest.json'
                });
                
                // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                this.state.tonConnection.restoreConnection().then(wallet => {
                    if (wallet) {
                        this.state.wallet = {
                            address: wallet.account.address,
                            connected: true
                        };
                        document.getElementById('wallet-address').textContent = wallet.account.address;
                    }
                });
            },
            
            // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
            connectWallet() {
                const walletsList = this.state.tonConnection.getWallets();
                const connector = this.state.tonConnection;
                
                connector.connect(walletsList[0]).then(wallet => {
                    this.state.wallet = {
                        address: wallet.account.address,
                        connected: true
                    };
                    localStorage.setItem('ton_wallet', JSON.stringify(this.state.wallet));
                    document.getElementById('wallet-address').textContent = wallet.account.address;
                    Telegram.WebApp.showAlert('TON –∫–æ—à–µ–ª–µ–∫ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!');
                }).catch(err => {
                    console.error('Connection error:', err);
                    Telegram.WebApp.showAlert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞');
                });
            },
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserArts() {
                const container = document.getElementById('user-arts-list');
                container.innerHTML = '';
                
                const statusFilter = document.querySelector('#arts-filter .nav-tab.active').dataset.status;
                
                const userArts = this.state.arts.filter(art => 
                    art.authorId === this.state.user.id &&
                    (statusFilter === 'all' || art.status === statusFilter)
                );
                
                if (userArts.length === 0) {
                    container.innerHTML = '<p>–ê—Ä—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
                    return;
                }
                
                userArts.forEach(art => {
                    const artEl = document.createElement('div');
                    artEl.className = 'art-card';
                    artEl.dataset.id = art.id;
                    artEl.innerHTML = `
                        <div class="art-preview" style="background-color: ${art.pixels[0] || '#ccc'};"></div>
                        <div class="art-info">
                            <div class="art-title">${art.title}</div>
                            <div class="art-status">${this.getArtStatusText(art.status)}</div>
                            ${art.status === 'approved' ? 
                                `<button class="btn btn-sm btn-primary auction-art-btn" data-id="${art.id}">–ê—É–∫—Ü–∏–æ–Ω</button>` : ''}
                            <button class="btn btn-sm btn-outline delete-art-btn" data-id="${art.id}">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    `;
                    container.appendChild(artEl);
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
                container.querySelectorAll('.auction-art-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.createAuctionForArt(parseInt(btn.dataset.id));
                    });
                });
                
                container.querySelectorAll('.delete-art-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.deleteArt(parseInt(btn.dataset.id));
                    });
                });
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
                document.querySelectorAll('#arts-filter .nav-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('#arts-filter .nav-tab').forEach(t => {
                            t.classList.remove('active');
                        });
                        tab.classList.add('active');
                        this.loadUserArts();
                    });
                });
            },
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞
            getArtStatusText(status) {
                const statusMap = {
                    'pending': '‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏',
                    'approved': '‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ',
                    'rejected': '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ'
                };
                return statusMap[status] || status;
            },
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞ –¥–ª—è –∞—Ä—Ç–∞
            createAuctionForArt(artId) {
                this.state.selectedArtForAuction = this.state.arts.find(a => a.id === artId);
                document.getElementById('auction-title').value = this.state.selectedArtForAuction.title;
                document.getElementById('create-auction-modal').classList.add('active');
            },
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –∞—Ä—Ç–∞
            deleteArt(artId) {
                this.state.arts = this.state.arts.filter(a => a.id !== artId);
                localStorage.setItem('arts', JSON.stringify(this.state.arts));
                Telegram.WebApp.showAlert('–ê—Ä—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!');
                this.loadUserArts();
            },
            
            // –†–µ–Ω–¥–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
            renderModerationContent(tab) {
                const container = document.getElementById('moderation-content');
                container.innerHTML = '';
                
                if (tab === 'arts') {
                    container.innerHTML = `
                        <h3>–ê—Ä—Ç—ã –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h3>
                        <div id="pending-arts-list"></div>
                    `;
                    this.loadPendingArts();
                } 
                else if (tab === 'moderators') {
                    if (!this.state.isAdmin) {
                        container.innerHTML = '<p>–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º–∏</p>';
                        return;
                    }
                    
                    container.innerHTML = `
                        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º–∏</h3>
                        <div class="form-group">
                            <label>–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ –ø–æ ID Telegram</label>
                            <input type="number" id="new-moderator-id" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                        </div>
                        <button class="btn btn-primary" id="add-moderator-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
                        
                        <h4>–¢–µ–∫—É—â–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã</h4>
                        <ul id="moderators-list" class="card"></ul>
                    `;
                    this.loadModeratorsList();
                }
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                document.querySelectorAll('#moderation-screen .nav-tab').forEach(tabElement => {
                    tabElement.classList.toggle('active', tabElement.dataset.tab === tab);
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('#moderation-screen .nav-tab').forEach(tabElement => {
                    tabElement.addEventListener('click', () => {
                        this.renderModerationContent(tabElement.dataset.tab);
                    });
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
                document.getElementById('add-moderator-btn')?.addEventListener('click', () => {
                    this.addModerator();
                });
            },
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
            loadPendingArts() {
                const container = document.getElementById('pending-arts-list');
                container.innerHTML = '';
                
                const pendingArts = this.state.arts.filter(art => art.status === 'pending');
                
                if (pendingArts.length === 0) {
                    container.innerHTML = '<p>–ù–µ—Ç –∞—Ä—Ç–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>';
                    return;
                }
                
                pendingArts.forEach(art => {
                    const artEl = document.createElement('div');
                    artEl.className = 'card';
                    artEl.innerHTML = `
                        <h4>${art.title}</h4>
                        <p>–ê–≤—Ç–æ—Ä: ${art.authorName}</p>
                        <div class="art-preview" style="height: 100px; background-color: ${art.pixels[0] || '#ccc'};"></div>
                        <div class="form-group">
                            <label>–†–µ—à–µ–Ω–∏–µ</label>
                            <select class="art-status-select" data-id="${art.id}">
                                <option value="pending">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
                                <option value="approved">–û–¥–æ–±—Ä–∏—Ç—å</option>
                                <option value="rejected">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</option>
                            </select>
                        </div>
                    `;
                    container.appendChild(artEl);
                    
                    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
                    const select = artEl.querySelector('.art-status-select');
                    select.value = art.status;
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
                    select.addEventListener('change', () => {
                        this.updateArtStatus(art.id, select.value);
                    });
                });
            },
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∞—Ä—Ç–∞
            updateArtStatus(artId, status) {
                const art = this.state.arts.find(a => a.id === artId);
                if (art) {
                    art.status = status;
                    localStorage.setItem('arts', JSON.stringify(this.state.arts));
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    if (this.state.currentScreen === 'moderation') {
                        this.loadPendingArts();
                    }
                    
                    Telegram.WebApp.showAlert(`–°—Ç–∞—Ç—É—Å –∞—Ä—Ç–∞ "${art.title}" –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${status}`);
                }
            },
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤
            loadModeratorsList() {
                const container = document.getElementById('moderators-list');
                container.innerHTML = '';
                
                this.state.moderators.forEach(id => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span>ID: ${id}</span>
                        ${id !== this.config.adminId ? 
                            `<button class="btn btn-sm btn-danger remove-moderator-btn" data-id="${id}">–£–¥–∞–ª–∏—Ç—å</button>` : 
                            ''}
                    `;
                    container.appendChild(li);
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤
                container.querySelectorAll('.remove-moderator-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = parseInt(btn.dataset.id);
                        this.removeModerator(id);
                    });
                });
            },
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
            addModerator() {
                const newId = parseInt(document.getElementById('new-moderator-id').value);
                if (!newId) return;
                
                if (this.state.moderators.includes(newId)) {
                    Telegram.WebApp.showAlert('–≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —è–≤–ª—è–µ—Ç—Å—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º');
                    return;
                }
                
                this.state.moderators.push(newId);
                localStorage.setItem('moderators', JSON.stringify(this.state.moderators));
                Telegram.WebApp.showAlert('–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                this.loadModeratorsList();
            },
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
            removeModerator(id) {
                this.state.moderators = this.state.moderators.filter(modId => modId !== id);
                localStorage.setItem('moderators', JSON.stringify(this.state.moderators));
                Telegram.WebApp.showAlert('–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
                this.loadModeratorsList();
            },
            
            // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
            updateProfile() {
                document.getElementById('art-count').textContent = 
                    this.state.arts.filter(a => a.authorId === this.state.user.id).length;
                
                document.getElementById('sold-count').textContent = 
                    this.state.auctions.filter(a => 
                        a.authorId === this.state.user.id && 
                        a.status === 'completed'
                    ).length;
                
                document.getElementById('auctions-count').textContent = 
                    this.state.auctions.filter(a => 
                        a.authorId === this.state.user.id && 
                        a.status === 'active'
                    ).length;
                    
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–æ–ª–∏
                let role = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                if (this.state.isModerator) role = '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä';
                if (this.state.isAdmin) role = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                document.getElementById('user-role').value = role;
            },
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            loadSampleArts() {
                // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –∞—Ä—Ç—ã, –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ
                if (this.state.arts.length > 0) return;
                
                this.state.arts.push(
                    {
                        id: 1,
                        title: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ç",
                        pixels: ["#000000", "#FF0000", "#0000FF"],
                        created: "2025-07-25T12:00:00Z",
                        authorId: this.state.user.id,
                        authorName: this.state.user.firstName,
                        status: "approved"
                    },
                    {
                        id: 2,
                        title: "–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è 42",
                        pixels: ["#00FF00", "#FFFF00", "#FF00FF"],
                        created: "2025-07-26T14:30:00Z",
                        authorId: 12345,
                        authorName: "–î—Ä—É–≥–æ–π –•—É–¥–æ–∂–Ω–∏–∫",
                        status: "approved"
                    }
                );
            },
            
            loadSampleAuctions() {
                if (this.state.auctions.length > 0) return;
                
                this.state.auctions.push(
                    {
                        id: 1,
                        artId: 1,
                        title: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ç",
                        description: "–ü–∏–∫—Å–µ–ª—å–Ω—ã–π –∞—Ä—Ç –∫–æ—Ç–∞ –≤ –∫–æ—Å–º–æ—Å–µ",
                        startPrice: 0.5,
                        currentPrice: 1.2,
                        duration: 7,
                        startDate: "2025-07-25T12:00:00Z",
                        endDate: "2025-08-01T12:00:00Z",
                        authorId: this.state.user.id,
                        bids: [
                            { userId: 12345, amount: 0.7, date: "2025-07-25T14:30:00Z" },
                            { userId: 67890, amount: 1.2, date: "2025-07-26T09:15:00Z" }
                        ],
                        status: "active"
                    }
                );
            },
            
            updateFeaturedAuctions() {
                const container = document.getElementById('featured-auctions');
                container.innerHTML = '';
                
                this.state.auctions.slice(0, 4).forEach(auction => {
                    const art = this.state.arts.find(a => a.id === auction.artId);
                    if (!art) return;
                    
                    const auctionEl = document.createElement('div');
                    auctionEl.className = 'art-card';
                    auctionEl.dataset.id = auction.id;
                    auctionEl.innerHTML = `
                        <div class="art-preview" style="background-color: ${art.pixels[0] || '#ccc'};"></div>
                        <div class="art-info">
                            <div class="art-title">${auction.title}</div>
                            <div class="art-price">${auction.currentPrice} TON</div>
                            <div class="art-status">–û—Å—Ç–∞–ª–æ—Å—å: ${this.getTimeLeft(auction.endDate)}</div>
                        </div>
                    `;
                    container.appendChild(auctionEl);
                });
            },
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            getTimeLeft(endDate) {
                const end = new Date(endDate);
                const now = new Date();
                const diff = end - now;
                
                if (diff <= 0) return '–∑–∞–≤–µ—Ä—à–µ–Ω';
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                return `${days}–¥ ${hours}—á`;
            }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => PixelBidApp.init());
    </script>
</body>
</html>